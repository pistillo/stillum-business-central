# ============================================================
# Stillum Registry API – Application Configuration
# ============================================================

# --- Datasource ---
quarkus.datasource.db-kind=postgresql
%dev.quarkus.datasource.username=${POSTGRES_USER:stillum}
%dev.quarkus.datasource.password=${POSTGRES_PASSWORD:stillum123}
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://${POSTGRES_HOST:localhost}:5432/${POSTGRES_DB:stillumdb}

%prod.quarkus.datasource.username=${POSTGRES_USER}
%prod.quarkus.datasource.password=${POSTGRES_PASSWORD}
%prod.quarkus.datasource.jdbc.url=jdbc:postgresql://${POSTGRES_HOST}:${POSTGRES_PORT:5432}/${POSTGRES_DB}

# --- Hibernate ---
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=false

# --- Flyway ---
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration

# --- MinIO / S3 (compatibile AWS SDK) ---
%dev.quarkus.s3.endpoint-override=http://${MINIO_HOST:localhost}:9000
quarkus.s3.path-style-access=true
quarkus.s3.aws.region=us-east-1
%dev.quarkus.s3.aws.credentials.type=static
%dev.quarkus.s3.aws.credentials.static-provider.access-key-id=${MINIO_ROOT_USER:minioadmin}
%dev.quarkus.s3.aws.credentials.static-provider.secret-access-key=${MINIO_ROOT_PASSWORD:minioadmin}
stillum.storage.artifacts-bucket=stillum-artifacts
stillum.storage.bundles-bucket=stillum-bundles
stillum.storage.presigned-url-expiry-seconds=300

# --- OpenAPI ---
quarkus.swagger-ui.always-include=true
mp.openapi.extensions.smallrye.info.title=Stillum Registry API
mp.openapi.extensions.smallrye.info.version=0.0.1
mp.openapi.extensions.smallrye.info.description=API per la gestione di artefatti e versioni

# ============================================================
# Test profile – Quarkus Dev Services (auto-PostgreSQL)
# ============================================================
%test.quarkus.datasource.devservices.enabled=true
%test.quarkus.datasource.devservices.image-name=postgres:16-alpine
%test.quarkus.flyway.migrate-at-start=true
%test.quarkus.hibernate-orm.log.sql=false
# S3 dev service (LocalStack) avviato automaticamente da Quarkus per i test
%test.quarkus.s3.devservices.enabled=true
%test.quarkus.s3.path-style-access=true
%test.stillum.rls.assume-role=stillum_app
