apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "stillum-platform.fullname" . }}-config
  labels:
    {{- include "stillum-platform.labels" . | nindent 4 }}
data:
  application.properties: |
    quarkus.log.level={{ .Values.config.loglevel }}
    quarkus.timezone.default-time-zone={{ .Values.config.timezone }}
    server.upload.max-size={{ .Values.config.maxUploadSize }}
    auth.token.expiry={{ .Values.config.tokenExpiry }}
    session.timeout={{ .Values.config.sessionTimeout }}
  keycloak-config.json: |
    {
      "realm": "{{ .Values.security.keycloak.realm }}",
      "auth-server-url": "{{ .Values.security.keycloak.serverUrl }}",
      "ssl-required": "external",
      "resource": "{{ .Values.security.keycloak.publicClient }}",
      "public-client": true,
      "confidential-port": 0
    }
  cors-config.json: |
    {
      "enabled": {{ .Values.security.cors.enabled }},
      "allowed-origins": [
        {{- range $origin := .Values.security.cors.allowedOrigins }}
        "{{ $origin }}",
        {{- end }}
      ],
      "allowed-methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allowed-headers": ["Content-Type", "Authorization"],
      "max-age": 3600
    }
